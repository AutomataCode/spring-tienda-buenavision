<!DOCTYPE html>
<html lang="es" xmlns:th="https://www.thymeleaf.org"
      th:replace="~{layouts/base :: layout(~{::title}, ~{::body}, _, _)}">

<head>
    <title>Pedido Confirmado - Buena Visión</title>
</head>

<body>

<div class="container py-5 text-center">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-7">

            <!-- Mensaje de Éxito -->
            <div th:if="${successMessage}" class="alert alert-success d-flex align-items-center mb-4" role="alert">
                <i class="fas fa-check-circle fa-2x me-3"></i>
                <div>
                    <h4 class="alert-heading">¡Pedido Realizado!</h4>
                    <p th:text="${successMessage}"></p>
                </div>
            </div>

             <!-- Mensaje de Error (si se redirige aquí con error, poco común) -->
             <div th:if="${errorMessage}" class="alert alert-danger" role="alert" th:text="${errorMessage}"></div>


            <!-- Detalles del Pedido Confirmado -->
            <div class="card shadow-sm mb-4" th:if="${pedido}">
                 <div class="card-header bg-light">
                    <h5>Resumen del Pedido #<span th:text="${pedido.numeroPedido}"></span></h5>
                </div>
                <div class="card-body text-start">
                    <p><strong>Fecha:</strong> <span th:text="${#temporals.format(pedido.fechaPedido, 'dd/MM/yyyy HH:mm')}"></span></p>
                    <p><strong>Cliente:</strong> <span th:text="${pedido.cliente.nombre + ' ' + pedido.cliente.apellido}"></span></p>
                    <p><strong>Dirección de Entrega:</strong> <span th:text="${pedido.direccionEntrega}"></span></p>
                    <p><strong>Estado:</strong> <span class="badge bg-info text-dark" th:text="${pedido.estado.name()}"></span></p>

                    <h6 class="mt-4">Productos:</h6>
                    <ul class="list-group list-group-flush mb-3">
                        <li th:each="detalle : ${pedido.detalles}" class="list-group-item d-flex justify-content-between align-items-center ps-0 pe-0">
                            <div>
                                <span th:text="${detalle.cantidad} + ' x '"></span>
                                <span th:text="${detalle.producto.nombre}"></span>
                                <small class="d-block text-muted" th:text="'S/ ' + ${#numbers.formatDecimal(detalle.precioUnitario, 1, 2)} + ' c/u'"></small>
                            </div>
							<span class="fw-bold" th:text="'S/ ' + ${#numbers.formatDecimal(detalle.subtotal, 1, 2)}"></span>
                        </li>
                    </ul>

                    <div class="border-top pt-3">
                        <p class="d-flex justify-content-between"><span>Subtotal:</span> <span th:text="'S/ ' + ${#numbers.formatDecimal(pedido.subtotal, 1, 2)}"></span></p>
                        <p class="d-flex justify-content-between"><span>IGV:</span> <span th:text="'S/ ' + ${#numbers.formatDecimal(pedido.igv, 1, 2)}"></span></p>
                        <p class="d-flex justify-content-between"><span>Descuento:</span> <span th:text="'S/ ' + ${#numbers.formatDecimal(pedido.descuento, 1, 2)}"></span></p>
                        <p class="d-flex justify-content-between fw-bold fs-5"><span>Total:</span> <span th:text="'S/ ' + ${#numbers.formatDecimal(pedido.total, 1, 2)}"></span></p>
                    </div>

                    <p class="mt-3 text-muted"><small>Recibirás una confirmación por correo electrónico (funcionalidad pendiente).</small></p>

                </div>
            </div>

            <div class="mt-4">
                <a th:href="@{/catalogo}" class="btn btn-outline-secondary me-2"><i class="fas fa-arrow-left me-1"></i> Seguir Comprando</a>
                <a th:href="@{/mis-pedidos}" class="btn btn-primary"><i class="fas fa-list-alt me-1"></i> Ver Mis Pedidos</a> 
            </div>

        </div>
    </div>
</div>

</body>
</html>
